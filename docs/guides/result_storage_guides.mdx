# Result Storages in `Crawlee`

Crawlee provides result storage types for managing data efficiently during the crawling process. These storage types allow saving data either in a `key-value` store or a `dataset`, depending on the structure and type of the data. The storage system is flexible, allowing to store data locally on the machine.

### MemoryStorage

At the heart of Crawlee's storage system is the `MemoryStorage` class. During a crawler run, all data is stored in memory and can also be saved to local files. This allows you to persist your data between runs or access it later.

---

## Key-Value Store

The key-value store is used for saving and reading data records or files. Each data record is represented by a unique key and associated with a MIME content type. Key-value stores are ideal for saving screenshots of web pages, PDFs, or for persisting the state of crawlers.

Each Crawlee project run is associated with a default key-value store. By convention, the project input and output are stored in the default key-value store under the `INPUT` and `OUTPUT` keys, respectively. Typically, both input and output are JSON files, although they can be in other formats.

In Crawlee, the key-value store is represented by the `KeyValueStore` class. To simplify access to the default key-value store, Crawlee provides the `KeyValueStore.getValue()` and `KeyValueStore.setValue()` functions.

### Example: Basic Operations in Key-Value Store

```jsx
import { KeyValueStore, Dataset, purgeDefaultStorages } from 'crawlee';

// Get input from the default key-value store
const input_data = KeyValueStore.getValue('INPUT');

// Save output to the default key-value store
KeyValueStore.setValue('OUTPUT', { result: 123 });

// Open a custom key-value store
const custom_store = KeyValueStore.open('my-store');

// Write data to the custom store
custom_store.setValue('my-key', { foo: 'bar' });

// Read data from the custom store
const stored_value = custom_store.getValue('my-key');

// Delete a record from the store
custom_store.setValue('my-key', null);
```

In the key-value store, data is saved in the local directory defined by the `CRAWLEE_STORAGE_DIR` environment variable, and the file structure is:

```jsx 
{CRAWLEE_STORAGE_DIR}/key_value_stores/{STORE_ID}/{KEY}.{EXT}
```
- `{STORE_ID}` is the name or the ID of the key-value store. The default key-value store has an ID of default, unless overridden by setting the `CRAWLEE_DEFAULT_KEY_VALUE_STORE_ID` environment variable.
- `{KEY}` is the unique key for each data record.
- `{EXT}` corresponds to the MIME content type of the data value (e.g., .json, .txt).

---

## Dataset

Datasets are designed to store structured data, where each record (or row) follows the same format. This is useful for storing things like product listings, real estate properties, or any other structured data that your crawler extracts.

Datasets are append-only, meaning you can add new records but cannot modify or remove existing ones. This makes datasets ideal for logging or recording each item crawled during a session.

### Example: Basic Operations in Dataset

```jsx
// Add a single record to the default dataset
Dataset.pushData({ product_name: 'Phone', price: 499.99 });

// Open a custom dataset
const custom_dataset = Dataset.open('my-dataset');

// Add multiple records
custom_dataset.pushData([
    { item: 'Laptop', price: 799.99 },
    { item: 'Tablet', price: 199.99 }
]);
```
Data in the dataset is stored as individual JSON files, with the following file structure:

```jsx 
{CRAWLEE_STORAGE_DIR}/datasets/{DATASET_ID}/{INDEX}.json
```
- `{DATASET_ID}` is the name or the ID of the dataset. The default dataset has an ID of default, unless overridden by setting the CRAWLEE_DEFAULT_DATASET_ID environment variable.
- `{INDEX}` is a zero-based index indicating the position of each item in the dataset.

## Cleaning Up Storages

By default, Crawlee cleans up (purges) result storages before a new crawler run. This ensures that outdated data doesn't interfere with new runs. If you need to manually clean up the storage during a run, you can use the `purgeDefaultStorages` function.

### Example: Purging Storage
```jsx
// Clean up storage directories
purgeDefaultStorages();
```
Calling this function will remove all data from the default storage directories, except for the input data stored under the INPUT key. This is a shortcut for running (optional) purge method on the `StorageClient` interface, in other words it will call the purge method of the underlying storage implementation we are currently using. In addition, this method will make sure the storage is purged only once for a given execution context, so it is safe to call it multiple times.
